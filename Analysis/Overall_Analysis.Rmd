---
title: "MSc Project"
author: "SOBOYEJO LUKMAN ADEBOYE"
date: "01/06/2020"
output: word_document
always_allow_html: true
---

```{r global_options, include = FALSE}
knitr::opts_knit$set(echo= FALSE)
```

## Packages Installed ----
```{r, warning= FALSE}
# pkgs <-
  (c("forecast", "patchwork", "ggplot2", "plotly", "tidyverse", "pander", "ggthemes", "reshape", "cowplot"))
# install.packages(pkgs)

library(forecast)   # For the moving avearage timeseries
library(patchwork)  # For combining plots
library(ggplot2)    # For Visualization
library(plotly)     # For interactive plot
library(lubridate)  #
library(knitr)
library(tidyverse)
library(pander)
library(ggthemes)
library(reshape2)
library(cowplot)
```

## Theme ----
```{r}

#Creating colour scheme
Mycolours <- c("dodgerblue3", "darkorange2", "hotpink2", "magenta3", "red", "skyblue1", "gold", "grey57")



season.summary <- function(){
      # Add a red line to the mean
    stat_summary(aes(ymax = ..y.., ymin = ..y..),
               fun = "mean",
               geom = "pointrange", 
               # Use geom_errorbar to add line as mean
               color = "red",
               position = position_dodge(width = 0.75), 
               # Add the line to each group
               show.legend = FALSE)

}
```


## Read file into R ----
```{r}
# Monthly Time series

san.mon.data <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Sanvitale.R/SanVitale Basin/san.mon.csv")
ras.mon.data <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Rasponi.R/Rasponi Basin/ras.mon.csv")
quin.mon.data <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Fosso_Ghiaia.R/Quinto Basin/quin.mon.csv")


# Yearly Time series

quin.ann.data <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Fosso_Ghiaia.R/Quinto Basin/quin.ann.csv")
ras.ann.data <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Rasponi.R/Rasponi Basin/ras.ann.csv")
san.ann.data <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Sanvitale.R/SanVitale Basin/san.ann.csv")

## Seasonal Average
wat_bal_san <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Sanvitale.R/SanVitale Basin/wat_bal_san.csv")
wat_bal_ras <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Rasponi.R/Rasponi Basin/wat_bal_ras.csv")
wat_bal_quin <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Fosso_Ghiaia.R/Quinto Basin/wat_bal_quin.csv")

## Water Budget
#water_budget <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/dat.csv")


## Drought Values
spi.data <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Code/Drought_Index.csv")
Drought_Index <- read.csv("D:/Bologna Project/Land_Reclamation_Excel_Data/Code/Drought_Index.csv")

## Subsidence
# subsidence <- read.delim("D:/Bologna Project/Land_Reclamation_Excel_Data/subsidence.txt")

# kable()
# pander()
```


## Time series ----
link to learn more about ggthemes
[link](https://jrnold.github.io/ggthemes/reference/index.html)


## Monthly Prec
```{r,warning= FALSE}

## Date Conversion to POSXCIT
newyear = parse_date_time(san.mon.data[, 1], "by")
date = as.Date.POSIXct(newyear)
# # change to date format
# mydate.ch <- format(date, "%b %Y")
# # change to factor
# mydate.fac <- factor(mydate.ch, unique(mydate.ch))

# Data Manipulation for P
# Time Series of precipitation
rain.ts <- ts(san.mon.data$p,
              frequency = 12,
              start = c(1971, 1))
# moving average
rain.ma = ma(rain.ts, order = 12, centre = T)
# unclass rain moving average
unclass.rain <- unclass(rain.ma)
# dput



# combined different type of object
df.rain <- tibble(date, unclass.rain)

Mycolours <-
  c(
    "dodgerblue3",
    "darkorange2",
    "hotpink2",
    "magenta3",
    "red",
    "skyblue1",
    "gold",
    "grey57",
    "tomato4",
    "lightsalmon1",
    "goldenrod2",
    "lemonchiffon2"
  )

# Data Visualization - ggplot2
(
  ppt = ggplot(df.rain,
               aes(x = date, y = unclass.rain)) +
    geom_line() +
    geom_smooth(
      method = "loess",
      formula = y ~ x,
      span = 0.3,
      level = 0.95,
      se = FALSE,
      na.rm = TRUE
    ) +
    labs(
      caption = "Data Source: ARPAe Emilia Romagna",
      title = "Monthly Rainfall",
      subtitle = "Rainfall (mm/month) representing the three coastal basins",
      y = "P (mm/month)",
      x = "Time",
      tag = "a"
    ) +
    scale_x_date(date_breaks = "5 year",
                 date_labels = "%Y") +
    theme_cowplot() 
    # annotate(
    #   geom = "curve",
    #   x = as.Date("2000-04-01"),
    #   y = 95,
    #   xend = as.Date("1998-04-01"),
    #   yend = 80,
    #   curvature = 0.5,
    #   arrow = arrow(length = unit(2, "mm"))
    # ) +
    # annotate(
    #   geom = "text",
    #   x = as.Date("2001-04-01"),
    #   y = 95,
    #   label = "maximum rainfall",
    #   hjust = "left",
    #   size = 5
    # ) +
    # annotate(
    #   geom = "curve",
    #   x = as.Date("1993-04-01"),
    #   y = 30,
    #   xend = as.Date("1988-04-01"),
    #   yend = 35,
    #   curvature = -0.3,
    #   arrow = arrow(length = unit(2, "mm"))
    # ) +
    # annotate(
    #   geom = "text",
    #   x = as.Date("1994-04-01"),
    #   y = 35,
    #   label = "mininmum rainfall",
    #   hjust = "left",
    #   size = 5
    # )
)


# ggsave(filename = "ppt.png",
#        dpi = 1200, height = 4,
#        width = 10,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
# dev.off()

```



## Monthly AET
```{r}
## Data Manipulation for PET
aet.ts <- ts(san.mon.data$aet, frequency = 12, start = c(1971,1))
# moving average
aet.ma = ma(aet.ts, order = 12, centre = T)
# unclass moving average
unclass.aet <- unclass(aet.ma)
# combined different type of object using tibble
df.aet <- tibble(date, unclass.aet)

## Data Visualization for AET
(aet = ggplot(df.aet,
             aes(x = date, y = unclass.aet)) +
  geom_line() +
  geom_smooth(method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = FALSE,
              na.rm = TRUE) +
  scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y") +
  labs(title = "Actual Evapotranspiration",
       subtitle = "Obtained using Thornthwaite Mather procedure (1957)",
       y = "AET (mm/month)",
       x = "Time",
       tag = "b") +
    theme_cowplot() +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()
    ) 
    # annotate(
    #   geom = "text",
    #   x = as.Date("2003-04-01"),
    #   y = 65,
    #   label = "...depends on the level of soil \n moisture content and rainfall",
    #   hjust = "left",
    #   color = "#BB2D05"
    # )
  )

# ggsave(filename = "aet.png",
#        dpi = 1200, height = 4,
#        width = 12,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
# dev.off()
```


## Monthly PET
```{r}
## Data Manipulation for PET
# Time Series of AET
pet.ts <- ts(san.mon.data$pet, frequency = 12, start = c(1971,1))
# moving average
pet.ma = ma(pet.ts, order = 12, centre = T)
# unclass moving average
unclass.pet <- unclass(pet.ma)
# combined different type of object using tibble
df.pet <- tibble(date, unclass.rain)


## Data Visualization for PET
(pet = ggplot(df.pet,
             aes(x = date, y = unclass.pet)) +
  geom_line() +
  geom_smooth(method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = FALSE,
              na.rm = TRUE) +
  scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y") +
  labs(title = "Potential Evapotranspiration",
       subtitle = "Obtained using Thornthwaite method (1948)",
       y = "PET(mm/month)",
       x = "Time",
       tag = "c") +
    theme_cowplot() +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()
    ) 
    # annotate(
    #   geom = "text",
    #   x = as.Date("2000-04-01"),
    #   y = 60,
    #   label = "...depends on temperature",
    #   hjust = "left",
    #   color = "#BB2D05"
    # )
  )

# ggsave(filename = "pet.png",
#        dpi = 1200, height = 4,
#        width = 12,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
# dev.off()
```


## Combine Plt1 ----
```{r}
library(patchwork)

(plt1 <- plot_grid(
  ppt,
  aet,
  pet,
  labels = c(''),
  label_size = 12,
  ncol = 1,
  align = 'h',
  axis = 1)
)

# 
# x = ppt/aet/pet + plot_layout(guides = 'collect')

ggsave(filename = "plt.png",
       dpi = 1200, height =10,
       width = 10,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## San Vitale Pu
```{r}
## Data Manipulation for Pumping in San Vitale
# Time series of Pumping
san.pump.ts <- ts(san.mon.data$pu, frequency = 12, start = c(1971,1))
# forecast using moving average
san.pump.ma = ma(san.pump.ts, order = 12, centre = T)
# combined different object to dataframe
unclass.san.pump <- unclass(san.pump.ma)
df.san.pump <- tibble(date, unclass.san.pump)


## pumping in san vitale basin 
san.pump = ggplot(df.san.pump,
  aes(x = date, y = unclass.san.pump)) +
    geom_line() +
    geom_smooth(method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = FALSE, 
              na.rm = TRUE) +
      scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y") +
    labs(caption = "Data source: Land Reclamation Authority (LRA)",
       title = "San Vitale Basin Pumping",
       y = "Pu (mm/month)",
       x = "Time", 
       tag = "") +
    theme_cowplot() +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line())
    
#      annotate(
#       geom = "curve",
#       x = as.Date("1978-04-01"),
#       y = 45,
#       xend = as.Date("1973-04-01"),
#       yend = 55,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#    geom_label(
#        x = as.Date("1981-04-01"),
#       y = 60,
#       label = "1971 to 1980 \n high water head",
#       hjust = "right",
#       size = 5
#     ) +
#     annotate(
#       geom = "curve",
#       x = as.Date("1988-04-01"),
#       y = 18,
#       xend = as.Date("1991-04-01"),
#       yend = 40,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = as.Date("1995-04-01"),
#       y = 48,
#       label = "1983 and 1993 \ndrought",
#       hjust = "middle",
#       size = 5
#     ) +
#     annotate(
#       geom = "curve",
#       x = as.Date("2018-04-01"),
#       y = 18,
#       xend = as.Date("2016-04-01"),
#       yend = 40,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = as.Date("2015-04-01"),
#       y = 48,
#       label = "2000 and 2018 \nunexpected drop",
#       hjust = "middle",
#       size = 5
#     )
#   )
ggsave(filename = "san.pump.png",
       dpi = 1200, height = 4,
       width = 10,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()

```

## San Vitale Pu/P
```{r}
## Data Manipulation for Pu/P
# Time Series
san.pup.ts <- ts(san.mon.data$pu.p, frequency = 12, start = c(1971,1))
# forecast using moving average
san.pup.ma = ma(san.pup.ts, order = 12, centre = T)
unclass.san.pup <- unclass(san.pup.ma)
# combined different object to data frame
df.san.pup <- tibble(date, unclass.san.pup)



## Visualization with ggplot
san.pup = ggplot(df.san.pup,
                       aes(x = date, y = unclass.san.pup)) +
     geom_line() +
     geom_smooth(method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = TRUE,
              na.rm = TRUE)  +
    scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y") +
    labs(caption = "",
       title = "San Vitale Pumping / Precipitation",
       x = "Time",
       y = "Pu/P",
       tag = "B") +
    theme_cowplot() +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line())
#     annotate(
#       geom = "curve",
#       x = as.Date("1985-04-01"),
#       y = 2.5,
#       xend = as.Date("1982-04-01"),
#       yend = 1.6,
#       curvature = 0.3,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = as.Date("1985-04-01"),
#       y = 2.6,
#       label = "high water head",
#       hjust = "middle",
#       size = 5
#     ) +
#     annotate(
#       geom = "curve",
#       x = as.Date("2005-04-01"),
#       y = 2.5,
#       xend = as.Date("2003-04-01"),
#       yend = 1.6,
#       curvature = 0.3,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = as.Date("2005-04-01"),
#       y = 2.6,
#       label = "rainfall maximum peak",
#       hjust = "middle",
#       size = 5
#     )
# )

# ggsave(filename = "san.pup.png",
#        dpi = 1200, height = 4,
#        width = 12,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
# dev.off()
```

## Combined plt2 ----
```{r, warning=FALSE}
# (plt2 <- plot_grid(
#   san.pump,
#   labels = c('AUTO'),
#   label_size = 12,
#   ncol = 1,
#   align = 'h',
#   axis = 1)
# )
# 
# ggsave(filename = "plt2.png",
#        dpi = 1200, height =12,
#        width = 11.5,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
# dev.off()
```

## San Vitale Infl
```{r}
# Data Manipulation for Infl
# Time Series
san.inf.ts <- ts(san.mon.data$infl, frequency = 12, start = c(1971,1))

# forecast using moving average
san.inf.ma = ma(san.inf.ts, order = 12, centre = T)
unclass.san.inf <- unclass(san.inf.ma)
# combined different object to data frame
df.san.inf <- tibble(date, unclass.san.inf)

## Infiltration in San Vitale
san.infl = ggplot(df.san.inf,
                      aes(x = date, y = unclass.san.inf)) +
      geom_line() +
      geom_smooth(method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = TRUE,
              na.rm = TRUE) +
      scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y") +
      labs(caption = "",
       title = "San Vitale - Infiltration Rate",
       subtitle = "Derived using empirical method",
       y = "Infl (mm/month)",
       x = "Time", 
       tag = "C") +
    theme_cowplot() +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line())


# ggsave(filename = "san.infl.png",
#        dpi = 1200, height = 4,
#        width = 12,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```

## San Vitale dS
```{r}
# Data Manipulation for storage
# Time Series
san.ds.ts <- ts(san.mon.data$ds, frequency = 12, start = c(1971,1))
# forecast using moving average
san.ds.ma = ma(san.ds.ts, order = 12, centre = T)

# combined different object to data frame
unclass.san.ds <- unclass(san.ds.ma)
df.san.ds <- tibble(date, unclass.san.ds)

## Data Visualization with ggplot2
(san.ds = ggplot(df.san.ds,
                      aes(x = date, y = unclass.san.ds)) +
      geom_line() +
      geom_smooth(aes(x = date, y = unclass.san.ds),
              method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = TRUE,
              na.rm = TRUE) +
      scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y") +
      labs(caption = "",
       title = "San Vitale Change in Water Storage (empirical)",
       subtitle = "Derived using empirical method",
       y = "dS (mm/month)",
       x = "Time", 
       tag = "D") +
    theme_cowplot() +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line())
)

# ggsave(filename = "san.ds.png",
#        dpi = 1200, height = 4,
#        width = 12,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()

```

## Rasponi Pu
```{r}

## Data Manipulation
# Time series
ras.pump.ts <- ts(ras.mon.data$pu, frequency = 12, start = c(1971,1))
# forecast using moving average
ras.pump.ma = ma(ras.pump.ts, order = 12, centre = T)
# combined different object to dataframe
unclass.ras.pump <- unclass(ras.pump.ma)
df.ras.pump <- tibble(date, unclass.ras.pump)


## pumping in san vitale basin 
ras.pump = ggplot(df.ras.pump,
                   aes(x = date, y = unclass.ras.pump)) +
      geom_line() +
       geom_smooth(method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = FALSE, 
              na.rm = TRUE) +
       scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y") +
       labs(caption = "Data Source: Land Reclamation Authority (LRA)",
            title = "Rasponi pumping",
            y = "Pu (mm/month)",
            x = "Time", 
       tag = "") +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()
    ) +
  theme_cowplot() 
#      annotate(
#       geom = "curve",
#       x = as.Date("1978-04-01"),
#       y = 25,
#       xend = as.Date("1975-04-01"),
#       yend = 35,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#    geom_label(
#        x = as.Date("1981-04-01"),
#       y = 40,
#       label = "1971 to 1980 \n high water head",
#       hjust = "right",
#       size = 5
#     ) +
#     annotate(
#       geom = "curve",
#       x = as.Date("1988-04-01"),
#       y = 10,
#       xend = as.Date("1991-04-01"),
#       yend = 35,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = as.Date("1995-04-01"),
#       y = 40,
#       label = "1983 and 1993 \ndrought",
#       hjust = "middle",
#       size = 5
#     ) 
#   )
# 
# ggsave(filename = "ras.pump.png",
#        dpi = 1200, height = 4,
#        width = 12,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
# dev.off()
  
```

## Rasponi Pu / P
```{r}
## Data Manipulation
# Times series
ras.pup.ts <- ts(ras.mon.data$pu.p, frequency = 12, start = c(1971,1))
# forecast using moving average
ras.pup.ma = ma(ras.pup.ts, order = 12, centre = T)

# combined different object to data frame
unclass.ras.pup <- unclass(ras.pup.ma)
df.ras.pup <- tibble(date, unclass.ras.pup)


## Pumping over Precipitation
(ras.pup = ggplot(df.ras.pup,
                     aes(x = date, y = unclass.ras.pup)) +
    geom_line() +
    geom_smooth(
      method = "loess",
      formula = y ~ x,
      span = 0.3,
      level = 0.95,
      se = TRUE,
      na.rm = TRUE)  +
    labs(
      caption = "",
      title = "pumping / precipitation",
      y = "Pu/P",
      x = "Time",
      tag = "B"
    ) +
    scale_x_date(
      date_breaks = "5 year",
      date_minor_breaks = "5 year",
      date_labels = "%Y"
    ) +
    theme_cowplot() +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()
    ) +
    annotate(
      geom = "curve",
      x = as.Date("1985-04-01"),
      y = 1.0,
      xend = as.Date("1982-04-01"),
      yend = 0.7,
      curvature = 0.3,
      arrow = arrow(length = unit(2, "mm"))
    ) +
    geom_label(
      x = as.Date("1985-04-01"),
      y = 1.0,
      label = "high water head",
      hjust = "middle",
      size = 5
    ) +
    annotate(
      geom = "curve",
      x = as.Date("2005-04-01"),
      y = 1.0,
      xend = as.Date("2003-04-01"),
      yend = 0.7,
      curvature = 0.7,
      arrow = arrow(length = unit(2, "mm"))
    ) +
    geom_label(
      x = as.Date("2003-04-01"),
      y = 1.0,
      label = "rainfall at maximum peak",
      hjust = "middle",
      size = 5
    )
)


ggsave(filename = "ras.pup.png",
       dpi = 1200,  height = 4,
        width = 12,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Combined plt3 ----
```{r, warning=FALSE}
(plt3 <- plot_grid(
  ppt,
  ras.pump,
  ras.pup,
  labels = c('AUTO'),
  label_size = 12,
  ncol = 1,
  align = 'h',
  axis = 1)
)

# ggsave(filename = "plt3.png",
#        dpi = 1200, height =12,
#        width = 11.5,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```


## Rasponi Infl
```{r}
## Data Manipulation
# Time Series
ras.inf.ts <- ts(ras.mon.data$infl, frequency = 12, start = c(1971,1))
# forecast using moving average
ras.inf.ma = ma(ras.inf.ts, order = 12, centre = T)
# combined different object to data frame
unclass.ras.inf <- unclass(ras.inf.ma)
df.ras.inf <- tibble(date, unclass.ras.inf)


## Infiltration
(ras.infl = ggplot(df.ras.inf,
                      aes(x = date, y = unclass.ras.inf)) +
  geom_line() +
  geom_smooth(method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = TRUE, 
              na.rm = TRUE)  +
  labs(caption = "",
       title = "Infiltration",
       subtitle = "Obtained using emprical method",
       y = "Infl (mm/month)",
       x = "Time", 
       tag = "C") +
        scale_x_date(
      date_breaks = "5 year",
      date_minor_breaks = "5 year",
      date_labels = "%Y"
    ) +
      theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()) +
    theme_cowplot()
)

# ggsave(filename = "ras.infl.png",
#        dpi = 1200, height = 4,
#        width = 12,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```

## Rasponi dS
```{r}
## Data Manipulation
# Time series
ras.ds.ts <- ts(ras.mon.data$ds, frequency = 12, start = c(1971,1))
# forecast using moving average
ras.ds.ma = ma(ras.ds.ts, order = 12, centre = T)
unclass.ras.ds <- unclass(ras.ds.ma)

# combined different object to data frame
df.ras.ds <- tibble(date, unclass.ras.ds)


## Infiltration
(ras.ds = ggplot(df.ras.ds,
                    aes(x = date, y = unclass.ras.ds)) +
  geom_line() +
  geom_smooth(aes(x = date, y = unclass.ras.ds),
              method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = TRUE, 
              na.rm = TRUE)  +
  labs(caption = "",
       title = "Change in Water Storage",
       subtitle = "Obtained using empirical method",
       y = "dS(mm/month)",
       x = "Time", 
       tag = "D") + 
        scale_x_date(
      date_breaks = "5 year",
      date_minor_breaks = "5 year",
      date_labels = "%Y"
    ) +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()
    ) +
    theme_cowplot() 
)

# ggsave(filename = "ras.ds.png",
#        dpi = 1200, height = 4,
#        width = 12,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```



## Quinto Pu
```{r}
## Data Manipulation
# Time Series
quin.pump.ts <- ts(quin.mon.data$pu, frequency = 12, start = c(1971,1))
# forecast using moving average
quin.pump.ma = ma(quin.pump.ts, order = 12, centre = T)
# combined different object to data frame
unclass.quin.pump <- unclass(quin.pump.ma)
df.quin.pump <- tibble(date, unclass.quin.pump)

## pumping 
quin.pump = ggplot(df.quin.pump,
                      aes(x = date, y = unclass.quin.pump)) +
  geom_line() +
    geom_smooth(method = "loess",
                formula = y ~ x,
                span = 0.3,
                level = 0.95,
                se = FALSE,
                na.rm = TRUE)  +
  labs(caption = "Data Source: Land Reclamation Consortium Ravenna",
       title = "Quinto Pumping",
       y = "Pu (mm/month)",
       x = "Time", 
       tag = "") +
       scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y") +
    theme_cowplot() +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()
    ) 
#      annotate(
#       geom = "curve",
#       x = as.Date("1978-04-01"),
#       y = 20,
#       xend = as.Date("1975-04-01"),
#       yend = 30,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#    geom_label(
#        x = as.Date("1971-04-01"),
#       y = 35,
#       label = "1971 to 1980 \n high water head",
#       hjust = "left",
#       size = 5
#     ) +
#     annotate(
#       geom = "curve",
#       x = as.Date("1988-04-01"),
#       y = 10,
#       xend = as.Date("1991-04-01"),
#       yend = 25,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#    geom_label(
#        x = as.Date("1986-04-01"),
#       y = 30,
#       label = "1983 and 1993 \ndrought",
#       hjust = "left",
#       size = 5
#     )
#   )
# 
# ggsave(filename = "quin.pump.png",
#        dpi = 1200, height = 4,
#        width = 10,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
# dev.off()
```

## Quinto Pu/P
```{r}
## Data Manipulation
# Time series
quin.pup.ts <- ts(quin.mon.data$pu.p, frequency = 12, start = c(1971,1))
# forecast using moving average
quin.pup.ma = ma(quin.pup.ts, order = 12, centre = T)
# combined different object to data frame
unclass.quin.pup <- unclass(quin.pup.ma)
df.quin.pup <- tibble(date, unclass.quin.pup)

## Data Visualization with ggplot2
(quin.pup = ggplot(df.quin.pup,
                     aes(x = date, y = unclass.quin.pup)) +
  geom_line() +
  geom_smooth(method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = TRUE,
              na.rm = TRUE)  +
  labs(title = "Pumping / Precipitation",
       y = "Pu/P",
       x = "Time", 
       tag = "B") +
       scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y")+
    theme_cowplot() +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line(),
    ) + 
    annotate(
      geom = "curve",
      x = as.Date("1985-04-01"),
      y = 1.0,
      xend = as.Date("1982-04-01"),
      yend = 0.7,
      curvature = 0.,
      arrow = arrow(length = unit(2, "mm"))
    ) +
    geom_label(
      x = as.Date("1983-04-01"),
      y = 1.2,
      label = "more of subsidence \nlimited rainfall",
      hjust = "left",
      size = 5
    ) +
    annotate(
      geom = "curve",
      x = as.Date("2005-04-01"),
      y = 1.1,
      xend = as.Date("2003-04-01"),
      yend = 0.7,
      curvature = 0,
      arrow = arrow(length = unit(2, "mm"))
    ) +
    geom_label(
      x = as.Date("2000-04-01"),
      y = 1.2,
      label = "increasing trend",
      hjust = "left",
      size = 5
    )
)
 
ggsave(filename = "quin.pup.png",
       dpi = 1200, height = 4,
       width = 10,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Combined Plt4---
```{r, warning=FALSE}
(plt4 <- plot_grid(
  san.pump,
  ras.pump,
  quin.pump,
  labels = c('AUTO'),
  label_size = 12,
  ncol = 1,
  align = 'h',
  axis = 1)
)

ggsave(filename = "plt4.png",
       dpi = 1200, height =10,
       width = 10,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Quinto Infl
```{r}
## Data Manipulation 
# Time Series
quin.inf.ts <- ts(quin.mon.data$infl, frequency = 12, start = c(1971,1))
# forecast using moving average
quin.inf.ma = ma(quin.inf.ts, order = 12, centre = T)
# unclass the time series
unclass.quin.inf <- unclass(quin.inf.ma)
# combined different object to data frame
df.quin.inf <- tibble(date, unclass.quin.inf)


## Data Visualization with ggplot2
(quin.infl = ggplot(df.quin.inf,
                      aes(x = date, y = unclass.quin.inf)) +
  geom_line() +
  geom_smooth(method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = TRUE, 
              na.rm = TRUE)  +
  labs(caption = "",
       title = "Infiltration",
       subtitle = "Obtained using empirical method",
       y = "Infl (mm/month)",
       x = "Time", 
       tag = "C") +
       scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y")+
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()) +
    theme_cowplot()
)

# ggsave(filename = "quin.infl.png",
#        dpi = 1200, height = 4,
#        width = 12,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```

## Quinto dS
```{r}
## Data Manipulation 
# Time series
quin.ds.ts <- ts(quin.mon.data$ds, frequency = 12, start = c(1971,1))
# forecast using moving average
quin.ds.ma = ma(quin.ds.ts, order = 12, centre = T)
# combined different object to data frame
unclass.quin.ds <- unclass(quin.ds.ma)
df.quin.ds <- tibble(date, unclass.quin.ds)


## Data Visualization with ggplot2
(quin.ds = ggplot(df.quin.ds,
                    aes(x = date, y = unclass.quin.ds)) +
  geom_line() +
  geom_smooth(aes(x = date, y = unclass.quin.ds),
              method = "loess",
              formula = y ~ x,
              span = 0.3,
              level = 0.95,
              se = TRUE, 
              na.rm = TRUE) +
  labs(title = "Change in Storage",
       subtitle = "Obtained using empirical method",
       y = "dS (mm/month)",
       x = "Time", 
       tag = "D") +
       scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y")+
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()) +
    theme_cowplot()
)

# ggsave(filename = "quin.ds.png",
#        dpi = 1200, height = 4,
#        width = 12,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```



# Modeling ----
# Annual P
```{r}
(rain.ann = ggplot(data = ras.ann.data, 
           mapping = aes(x = year, y = p)) +
  geom_line() + 
  geom_smooth(method = "loess", 
              formula = y ~ x, 
              span = 0.5, 
              level = 0.95, 
              se = TRUE, 
              na.rm = FALSE)+
  labs(x = "Time", 
       y = "P (mm/yr)", 
       title = "Annual Rainfall",
       subtitle = "Representing the three coastal basins",
       tag = "A") +
   theme_cowplot()+
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()) +
   annotate(
     "segment",
     x = c(1997,2007),
     xend = c(2019,2019),
     y = c(774.16,593.41),
     yend = c(774.16,593.41),
     linetype = "dashed") +
    annotate(
      geom = "text",
      x = c(2007,2021),
      y = c(850, 700),
      label = c("??time (1997 to 2006)","??P"),
      hjust = "middle",
      color = "#BB2D05") +
    annotate(
      geom = "curve",
      x = c(2019,2019),
      y = c(700,600),
      xend = c(2019,2019),
      yend = c(600,780),
      curvature = 0.0, arrow = arrow(length = unit(2, "mm")))
  )

# ggsave(filename = "rain.ann.png",
#        dpi = 1200, height = 4,
#        width = 10,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()

```

## Annual AET
```{r}
(aet.ann = ggplot(data = ras.ann.data, 
                 mapping = aes(x = year, y = aet)) +
  geom_line() + 
  geom_smooth(method = "loess", 
              formula = y ~ x, 
              span = 0.5, 
              level = 0.95, se = TRUE, 
              na.rm = FALSE) +
  labs(x = "Time", 
       y = "AET (mm/yr)", 
       title = "Actual Evapotranspiration",
       subtitle = "Obtained using Thornthwaite Mather procedure (1957)", 
       tag = "B") +
   theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()) +
   theme_cowplot() +
   annotate(
     "segment",
     x = c(1997,2007),
     xend = c(2019,2019),
     y = c(590,505),
     yend = c(586.95,504.84),
     linetype = "dashed") +
    annotate(
      geom = "text",
      x = c(2007,2021),
      y = c(610, 550),
      label = c("?? time (1997-2006)","??P"),
      hjust = "middle",
      color = "#BB2D05") +
    annotate(
      geom = "curve",
      x = c(2019,2019),
      y = c(550,550),
      xend = c(2019,2019),
      yend = c(590,505),
      curvature = 0.0, arrow = arrow(length = unit(2, "mm")))
  )
# 
# ggsave(filename = "aet.ann.pump.png",
#        dpi = 1200, height = 4,
#        width = 10,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```

## Annual PET
```{r}
(pet = ggplot(data = ras.ann.data, 
             mapping = aes(x = year, y = pet)) +
  geom_line() + 
  geom_smooth(method = "loess", 
              formula = y ~ x, 
              span = 0.5, 
              level = 0.95, 
              se = TRUE, 
              na.rm = FALSE) +
  labs(x = "Year", 
       y = "PET", 
       title = "Potential ET over the Area") +
    theme_cowplot()
)


# ggsave(filename = "pet.ann.png",
#        dpi = 1200, height = 4,
#        width = 10,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
  
```

# Annual Rasponi
```{r}
## Visualization with ggplot
(ras.ann.pump = ggplot(data = ras.ann.data, 
              mapping = aes(x = year, y = pu)) +
    geom_line() + 
   geom_smooth(method = "loess", 
              formula = y ~ x, 
              span = 0.5, 
              level = 0.96, 
              se = TRUE, 
              na.rm = FALSE)+
    labs(x = "Time", 
       y = "Pu (mmyr)", 
       title = "Rasponi Basin (Annual Pumping)",
       tag = "b") +
   theme_cowplot() +
   theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()) +
   annotate(
     "segment",
     x = c(2007, 2018),
     xend = c(2021, 2021),
     y = c(146.05,251.89),
     yend = c(146.05,251.89),
     linetype = "dashed") +
    annotate(
      geom = "text",
      x = c(2015,2023),
      y = c(120, 200),
      label = c("??time (2007 - 2018)","??P"),
      hjust = "middle",
      color = "#BB2D05") +
    annotate(
      geom = "curve",
      x = c(2021,2021),
      y = c(155,155),
      xend = c(2021,2021),
      yend = c(146,251),
      curvature = 0.0, arrow = arrow(length = unit(2, "mm")))
  )
  
ggsave(filename = "ras.ann.pump.png",
       dpi = 1200, height = 4,
       width = 10,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()

```

## Annual San Vitale Pu
```{r}
(san.ann.pump = ggplot(data = san.ann.data,
                      mapping = aes(x = year, y = pu)) +
    geom_line() + 
    geom_smooth(method = "loess", 
              formula = y ~ x, 
              span = 0.5, 
              level = 0.95, 
              se = TRUE, 
              na.rm = FALSE) +
   labs(x = "Time", 
       y = "pu (mm/yr)", 
       title = "San Vitale Basin - Annual Pumping",
       tag = "a") +
   theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()) +
   theme_cowplot() +
   annotate(
     "segment",
     x = c(2007, 2018),
     xend = c(2021, 2021),
     y = c(315.06,125.87),
     yend = c(315.06,125.87),
     linetype = "dashed") +
    annotate(
      geom = "text",
      x = c(2015,2023),
      y = c(400, 250),
      label = c("??time (2007 - 2018)","??P"),
      hjust = "middle",
      color = "#BB2D05") +
    annotate(
      geom = "curve",
      x = c(2021,2021),
      y = c(290,290),
      xend = c(2021,2021),
      yend = c(315,125.87),
      curvature = 0.0, arrow = arrow(length = unit(2, "mm")))
  )
  

ggsave(filename = "san.ann.pump.png",
       dpi = 1200, height = 4,
       width = 10,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```


## Annual Quinto
```{r}
(quin.ann.pump = ggplot(data = quin.ann.data,
            mapping = aes(x = year, y = pu)) +
    geom_line() + 
    geom_smooth(method = "loess",
              formula = y ~ x,
              span = 0.5, 
              level = 0.95,
              se = TRUE, 
              na.rm = FALSE) +
    labs(x = "Time", 
       y = "Pu (mm/yr)", 
       title = "Quinto Basin (Annual Pumping)",
       tag = "c") +
   theme_cowplot() +
   theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()) +
   annotate(
     "segment",
     x = c(2007, 2018),
     xend = c(2021, 2021),
     y = c(234.23, 291.96),
     yend = c(234.23, 291.96),
     linetype = "dashed"
   ) +
   annotate(
     geom = "text",
     x = c(2015, 2023),
     y = c(190,260),
     label = c("??time (2007-2018)", "??P"),
     hjust = "middle",
     color = "#BB2D05"
   ) +
   annotate(
     geom = "curve",
     x = c(2021, 2021),
     y = c(260, 250),
     xend = c(2021, 2021),
     yend = c(234, 291),
     curvature = 0.0,
     arrow = arrow(length = unit(2, "mm"))
   )
)
  

ggsave(filename = "quin.ann.pump.png",
       dpi = 1200, height = 4,
       width = 10,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Seasonality ----
## Rainfall
```{r, warning= FALSE}
# select the column
rain <- san.mon.data[,2]
# Combined Observations into data frame
df.rain <- tibble(date, rain)

season.rain <- df.rain %>%
  # Convert data frame from lwide format to long format
  gather(season.rain, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.rain = str_replace(season.rain, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.rain$Month = factor(season.rain$Month, levels = month.abb)

# Visualization with ggplot
ppt = ggplot(season.rain, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = FALSE) +
    labs(caption = "Data Source: ARPAe Emilia Romagna",
         x = "Month",
         y = "P (mm/month)",
         title = "Rainfall",
         subtitle = "Representing the three coastal basins",
         tag = "a") +
  season.summary () +
    theme_cowplot() +
  scale_y_continuous(limits = c(0, 150))
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 8.5,
#       xmax = 11.5,
#       ymin = 0,
#       ymax = 150,
#       size = 0.5
#     ) +
#   annotate(geom = "curve",
#       x = 8,
#       y = 250,
#       xend = 10,
#       yend = 150,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 6,
#       y = 270,
#       label = "Rainfall at maximum \n in the Autumn",
#       hjust = "left",
#       size = 4,
#       show.legend = FALSE
#     )  
#   )
# 
# 
ggsave(filename = "ppt.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```
## PET
```{r,warning=FALSE}
# select the column
pet <- san.mon.data[,3]
# Combined Observations into data frame
df.pet <- tibble(date, pet)

season.pet <- df.pet %>%
  # Convert data frame from lwide format to long format
  gather(season.pet, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.pet = str_replace(season.pet, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.pet$Month = factor(season.pet$Month, levels = month.abb)

# Visualization with ggplot
pet.ssn = ggplot(season.pet, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = TRUE) +
    labs(
      x = "Month",
      y = "PET (mm/month)",
      title = "Potential ET",
      subtitle = "Obtained using Thornthwaite method (1948)",
      tag = "c"
    ) + season.summary() +
  theme_cowplot() +
  scale_y_continuous(limits = c(0, 150))
#   annotate(
#     geom = "text",
#     x = 2,
#     y = 155,
#     label = "Peak Seasons \n (Summer - Jun to Jul) \n Early Spring \n Early Autumn ",
#     hjust = "middle",
#     color = "#BB2D05"
#   )
#   )
# 
# # ggplotly(pet)
# 
ggsave(filename = "pet.ssn.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## AET
```{r}
# select the column
aet <- san.mon.data[,4]
# Combined Observations into data frame
df.aet <- tibble(date, aet)

season.aet <- df.aet %>%
  # Convert data frame from lwide format to long format
  gather(season.aet, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.aet = str_replace(season.aet, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.aet$Month = factor(season.aet$Month, levels = month.abb)

# Visualization with ggplot
aet.ssn = ggplot(season.aet, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = FALSE) +
    labs(x = "Month",
         y = "AET (mm/month)",
         title = "Actual ET",
         subtitle = "Obtained using Thornthwaite Mather procedure (1957)",
         tag = "b") +
    season.summary() +
    theme_cowplot() 
#   annotate(
#     geom = "text",
#     x = 2,
#     y = 125,
#     label = "Peak Seasons \n (Summer - Jun to Jul) \n Late Spring \n Early Autumn",
# 
#     hjust = "middle",
#     color = "#BB2D05"
#   )
#   )
# # ggplotly(aet)
# 
ggsave(filename = "aet.ssn.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```



## San Vitale Pu
```{r,warning= FALSE}
# select the column
pu <- san.mon.data[,5]
# Combined Observations into data frame
df.pu <- tibble(date, pu)

season.pu <- df.pu %>%
  # Convert data frame from lwide format to long format
  gather(season.pu, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.pu = str_replace(season.pu, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.pu$Month = factor(season.pu$Month, levels = month.abb)

# Visualization with ggplot
san_pu <- ggplot(season.pu, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = FALSE) +
    labs(x = "Month",
         y = "Pu (mm/month)",
         title = "San Vitale basin (Pumping)",
         tag = "a") +
  season.summary()+
    theme_cowplot()+
  scale_y_continuous(limits = c(0, 100))
#     annotate(
#       geom = "curve",
#       x = 2,
#       y = 55,
#       xend = 3,
#       yend = 100,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 2,
#       y = 105,
#       label = "High drainage \n winter then late spring",
#       hjust = "left",
#       size = 4,
#       show.legend = FALSE
#     ) +
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 0,
#       xmax = 4.5,
#       ymin = 0,
#       ymax = 55,
#       size = 0.5
#     ) +
#   annotate(geom = "curve",
#       x = 7,
#       y = 25,
#       xend = 8,
#       yend = 80,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 7.5,
#       y = 90,
#       label = "Low Drainage in the \nsummer and winter",
#       hjust = "left",
#       size = 4,
#       show.legend = FALSE
#     ) +
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 4.5,
#       xmax = 11.5,
#       ymin = 0,
#       ymax = 35,
#       size = 0.5
#     ) +
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 11.5,
#       xmax = 12.5,
#       ymin = 0,
#       ymax = 55,
#       size = 0.5
#     ) 
# )
ggsave(filename = "san_pu.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```


## SanVitale Pu/P
```{r, warning= FALSE}
# select the column
pup <- san.mon.data[,6]
# Combined Observations into data frame
df.pup <- tibble(date, pup)

season.pup <- df.pup %>%
  # Convert data frame from lwide format to long format
  gather(season.pup, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.pup = str_replace(season.pup, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.pup$Month = factor(season.pup$Month, levels = month.abb)

# Visualization with ggplot
san_pup = ggplot(season.pup, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = TRUE) +
    labs(x = "Month",
         y = "Pu/P",
         title = "Precipitation / Pumping Ratio",
         tag = "b") +
    scale_y_continuous(limits = c(0, 3)) +
  season.summary() +
    theme_cowplot() 
#       annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 4.5,
#       xmax = 8.5,
#       ymin = 0,
#       ymax = 1.5,
#       size = 0.5
#     ) +
#   annotate(geom = "curve",
#       x = 7,
#       y = 2,
#       xend = 7,
#       yend = 1.2,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 7,
#       y = 2.5,
#       label = "summer pumping is raised \nhowever, not obvious",
#       hjust = "middle",
#       size = 4,
#       show.legend = FALSE
#     )
# )
ggsave(filename = "san_pup.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## San Vitale Infl
```{r, warning= FALSE}
# select the column
infl <- san.mon.data[,7]
# Combined Observations into data frame
df.infl <- tibble(date, infl)

season.infl <- df.infl %>%
  # Convert data frame from lwide format to long format
  gather(season.infl, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.infl = str_replace(season.infl, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.infl$Month = factor(season.infl$Month, levels = month.abb)

# Visualization with ggplot
san_infl.ssn = ggplot(season.infl, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = FALSE) +
    labs(x = "Month",
         y = "Infl (mm/month)",
         title = "San Vitale Infiltration",
         tag = "c") +
  season.summary() +
    scale_y_continuous(limits = c(0, 100)) +
    theme_cowplot()
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 9.5,
#       xmax = 11.5,
#       ymin = 0,
#       ymax = 50,
#       size = 0.5
#     ) +
#     annotate(
#       geom = "curve",
#       x = 11,
#       y = 50,
#       xend = 10,
#       yend = 70,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 9,
#       y = 85,
#       label = "Infiltration increases \n due to rainfall and \n drainage is low",
#       hjust = "middle",
#       size = 4,
#       show.legend = FALSE
#     )
# )

ggsave(filename = "san_infl.ssn.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```


## San Vitale dS
```{r,warning= FALSE}
# select the column
dS <- san.mon.data[,8]
# Combined Observations into data frame
df.dS <- tibble(date, dS)

season.dS <- df.dS %>%
  # Convert data frame from lwide format to long format
  gather(season.dS, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.dS = str_replace(season.dS, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.dS$Month = factor(season.dS$Month, levels = month.abb)

# Visualization with ggplot
san_dS.ssn = ggplot(season.dS, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = TRUE) +
    labs(x = "Month",
         y = "??S (mm/month)",
         title = "Change in Water Storage",
         tag = "d") +
    season.summary()+
    theme_cowplot()

# ggplotly(san_dS)

ggsave(filename = "san_dS.ssn.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```


## Rasponi Pu
```{r, warning= FALSE}
# select the column
pu <- ras.mon.data[,5]
# Combined Observations into data frame
df.pu <- tibble(date, pu)

season.pu <- df.pu %>%
  # Convert data frame from lwide format to long format
  gather(season.pu, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.pu = str_replace(season.pu, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.pu$Month = factor(season.pu$Month, levels = month.abb)

# Visualization with ggplot
ras_pu <- ggplot(season.pu, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot( show.legend = FALSE) +
    labs(x = "Month",
         y = "Pu (mm/month)",
         title = "Rasponi basin (Pumping)",
         tag = "a") +
   season.summary() +
    scale_y_continuous(limits = c(0, 70)) +
    theme_cowplot() 
#     annotate(
#       geom = "curve",
#       x = 2,
#       y = 50,
#       xend = 3,
#       yend = 100,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 2,
#       y = 100,
#       label = "High drainage \nwinter then late spring",
#       hjust = "left",
#       size = 4,
#       show.legend = FALSE
#     ) +
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 0,
#       xmax = 4.5,
#       ymin = 0,
#       ymax = 50,
#       size = 0.5
#     ) +
#   annotate(geom = "curve",
#       x = 7,
#       y = 25,
#       xend = 8,
#       yend = 80,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 7.5,
#       y = 90,
#       label = "Low Drainage in the \nsummer and winter",
#       hjust = "left",
#       size = 4,
#       show.legend = FALSE
#     ) +
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 4.5,
#       xmax = 11.5,
#       ymin = 0,
#       ymax = 25,
#       size = 0.5
#     ) +
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 11.5,
#       xmax = 12.5,
#       ymin = 0,
#       ymax = 50,
#       size = 0.5
#     ) 
# )
ggsave(filename = "ras_pu.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Rasponi Pu/P
```{r, warning= FALSE}
# select the column
pup <- ras.mon.data[,6]
# Combined Observations into data frame
df.pup <- tibble(date, pup)

season.pup <- df.pup %>%
  # Convert data frame from lwide format to long format
  gather(season.pup, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.pup = str_replace(season.pup, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.pup$Month = factor(season.pup$Month, levels = month.abb)

# Visualization with ggplot
ras_pup = ggplot(season.pup, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = TRUE) +
    labs(x = "Month",
         y = "Pu/P",
         title = "Precipitation / Pumping Ratio",
         tag = "b") +
    scale_y_continuous(limits = c(0, 2)) +
  season.summary() +
    theme_cowplot() 
#       annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 4.5,
#       xmax = 8.5,
#       ymin = 0,
#       ymax = 1,
#       size = 0.5
#     ) +
#   annotate(geom = "curve",
#       x = 7,
#       y = 2,
#       xend = 7,
#       yend = 0.5,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 7,
#       y = 2,
#       label = "summer umping is raised \nnot obvious",
#       hjust = "middle",
#       size = 4,
#       show.legend = FALSE
#     )
# )
ggsave(filename = "ras_pup.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Rasponi Infl
```{r, warning = FALSE}
# select the column
infl <- ras.mon.data[,7]
# Combined Observations into data frame
df.infl <- tibble(date, infl)

season.infl <- df.infl %>%
  # Convert data frame from lwide format to long format
  gather(season.infl, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.infl = str_replace(season.infl, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.infl$Month = factor(season.infl$Month, levels = month.abb)

# Visualization with ggplot
ras_infl = ggplot(season.infl, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = FALSE) +
    labs(x = "Month",
         y = "Infl (mm/month)",
         title = "Rasponi Infiltration",
         tag = "c") +
    scale_y_continuous(limits = c(0, 100)) +
  season.summary()+
    theme_cowplot() 
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 9.5,
#       xmax = 11.5,
#       ymin = 0,
#       ymax = 55,
#       size = 0.5
#     ) +
#     annotate(
#       geom = "curve",
#       x = 11,
#       y = 50,
#       xend = 10,
#       yend = 70,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 9,
#       y = 85,
#       label = "Infiltration increases \n due to rainfall and \n drainage is low",
#       hjust = "middle",
#       size = 4,
#       show.legend = FALSE
#     )
# )

ggsave(filename = "ras_infl.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Rasponi dS
```{r,warning= FALSE}
# select the column
dS <- ras.mon.data[,8]
# Combined Observations into data frame
df.dS <- tibble(date, dS)

season.dS <- df.dS %>%
  # Convert data frame from lwide format to long format
  gather(season.dS, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.dS = str_replace(season.dS, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.dS$Month = factor(season.dS$Month, levels = month.abb)

# Visualization with ggplot
ras_dS = ggplot(season.dS, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = TRUE) +
    labs(x = "Month",
         y = "??S (mm/month)",
         title = "Change in Water Storage",
         tag = "d") +
    season.summary() +
  theme_cowplot()

# ggplotly(ras_dS)

ggsave(filename = "ras_dS.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Quinto Pu
```{r, warning= FALSE}
# select the column
pu <- quin.mon.data[,5]
# Combined Observations into data frame
df.pu <- tibble(date, pu)

season.pu <- df.pu %>%
  # Convert data frame from lwide format to long format
  gather(season.pu, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.pu = str_replace(season.pu, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.pu$Month = factor(season.pu$Month, levels = month.abb)

# Visualization with ggplot
quin_pu <- ggplot(season.pu, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = FALSE) +
    labs(x = "Month",
         y = "Pu (mm/month)",
         title = "Quinto basin (pumping)",
         tag = "a") +
    scale_y_continuous(limits = c(0, 75)) +
  season.summary()+
    theme_cowplot()
#     ylim(y1 = c(0, 150)) +
#     annotate(
#       geom = "curve",
#       x = 2,
#       y = 50,
#       xend = 3,
#       yend = 100,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 2,
#       y = 115,
#       label = "High drainage \n winter then late spring",
#       hjust = "left",
#       size = 4,
#       show.legend = FALSE
#     ) +
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 0,
#       xmax = 4.5,
#       ymin = 0,
#       ymax = 50,
#       size = 0.5
#     ) +
#   annotate(geom = "curve",
#       x = 7,
#       y = 25,
#       xend = 8,
#       yend = 80,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 7.5,
#       y = 95,
#       label = "Low Drainage in the \nsummer and winter",
#       hjust = "left",
#       size = 4,
#       show.legend = FALSE
#     ) +
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 4.5,
#       xmax = 11.5,
#       ymin = 0,
#       ymax = 25,
#       size = 0.5
#     ) +
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 11.5,
#       xmax = 12.5,
#       ymin = 0,
#       ymax = 50,
#       size = 0.5
#     ) 
# )

ggsave(filename = "quin.pu.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Quinto Pu/P
```{r, warning= FALSE}
# select the column
pup <- quin.mon.data[,6]
# Combined Observations into data frame
df.pup <- tibble(date, pup)

season.pup <- df.pup %>%
  # Convert data frame from lwide format to long format
  gather(season.pup, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.pup = str_replace(season.pup, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.pup$Month = factor(season.pup$Month, levels = month.abb)

# Visualization with ggplot
quin_pup = ggplot(season.pup, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend = TRUE) +
    labs(x = "Month",
         y = "Pu/P",
         title = "Precipitation / Pumping Ratio") +
    scale_y_continuous(limits = c(0, 2)) +
  season.summary()+
    theme_cowplot()
#       annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 4.5,
#       xmax = 8.5,
#       ymin = 0,
#       ymax = 1,
#       size = 0.5
#     ) +
#   annotate(geom = "curve",
#       x = 7,
#       y = 2,
#       xend = 7,
#       yend = 0.5,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 7,
#       y = 2.2,
#       label = "Pumping is raised in July",
#       hjust = "middle",
#       size = 4,
#       show.legend = FALSE
#     )
# )
# 

ggsave(filename = "quin_pup.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Quinto Infl
```{r, warning= FALSE}
# select the column
infl <- quin.mon.data[,7]
# Combined Observations into data frame
df.infl <- tibble(date, infl)

season.infl <- df.infl %>%
  # Convert data frame from lwide format to long format
  gather(season.infl, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.infl = str_replace(season.infl, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.infl$Month = factor(season.infl$Month, levels = month.abb)

# Visualization with ggplot
quin_infl = ggplot(season.infl, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot(show.legend =  FALSE) +
    labs(x = "Month",
         y = "Infl (mm/month)",
         title = "Quinto Infiltration",
         tag = "c") +
    scale_y_continuous(limits = c(0, 100)) +
    season.summary()+
    theme_cowplot() 
#     annotate(
#       "rect",
#       alpha = 0,
#       color = "black",
#       xmin = 9.5,
#       xmax = 11.5,
#       ymin = 0,
#       ymax = 50,
#       size = 0.5
#     ) +
#     annotate(
#       geom = "curve",
#       x = 11,
#       y = 50,
#       xend = 10,
#       yend = 70,
#       curvature = 0,
#       arrow = arrow(length = unit(2, "mm"))
#     ) +
#     geom_label(
#       x = 9,
#       y = 85,
#       label = "Infiltration increases \n due to rainfall and \n drainage is low",
#       hjust = "middle",
#       size = 4,
#       show.legend = FALSE
#     )
# )
ggsave(filename = "quin_infl.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Quinto dS
```{r, warning= TRUE}
# select the column
dS <- quin.mon.data[,8]
# Combined Observations into data frame
df.dS <- tibble(date, dS)

season.dS <- df.dS %>%
  # Convert data frame from lwide format to long format
  gather(season.dS, value, -date) %>%
  # Remove "obs" in the Observation column
  mutate(season.dS = str_replace(season.dS, "date", "")) %>%
  # Convert the DATE column to date class
  mutate(DATE = ymd(date)) %>%
  # Create Month column
  mutate(Month = month(date)) %>%
  # Create Season column
  mutate(Month = case_when(
    Month %in% c(1)      ~ "Jan",
    Month %in% c(2)       ~ "Feb",
    Month %in% c(3)       ~ "Mar",
    Month %in% c(4)     ~ "Apr",
    Month %in% c(5)      ~ "May",
    Month %in% c(6)       ~ "Jun",
    Month %in% c(7)       ~ "Jul",
    Month %in% c(8)     ~ "Aug",
    Month %in% c(9)      ~ "Sep",
    Month %in% c(10)       ~ "Oct",
    Month %in% c(11)       ~ "Nov",
    Month %in% c(12)     ~ "Dec",
    TRUE                        ~ NA_character_
  ))

# Convert to factor
season.dS$Month = factor(season.dS$Month, levels = month.abb)

# Visualization with ggplot
(quin_dS = ggplot(season.dS, aes(x = Month, y = value,
                      fill = Month, 
                      class = Month)) +
    # Specify the geom to be boxplot
    geom_boxplot() +
    labs(x = "Month",
         y = "??S (mm/month)",
         title = "Change in Water Storage",
         tag = "d") +
    season.summary()+
    theme_cowplot()
)
ggsave(filename = "quin_dS.png",
       dpi = 1200, height = 4,
       width = 6,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```



## Seasonal AVG ----
## Hydroclimate 
```{r}
wat_bal_san$mont = factor(wat_bal_san$Mon, levels = month.abb)

(san_avg <- ggplot(wat_bal_san)+
  geom_line(aes(mont,  P, group = 1, color = "P"),
            size = 1) +
  geom_line(aes(mont,  AET, group = 1, color = "AET"),
            size = 1) +
  geom_line(aes(mont,  PET, group = 1, color = "PET"),
            size = 1) +
  scale_color_manual(name = "mm/month",
                     values=c("P" = "307FE2",
                              "AET" = "1E3F63", 
                              "PET" ="steelblue")) +
  labs(x = "Months",
       y = "Average Value",
       title = "Hydroclimatic Components") +
    annotate(
      "text",
      x = c(2, 7, 11.5),
      y = c(28, 100, 35),
      label = c("Surpus\nP > AET", "Deficit\nPET > AET", "Surplus\nP > AET"),
      size = 3
    ) +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line()
    ) +
    theme_cowplot()
)
```
## Plt5---
```{r}
(plt5 <- plot_grid(
  ppt,
  aet,
  pet,
  san_avg,
  labels = c('AUTO'),
  label_size = 12,
  ncol = 2,
  axis = 1)
)

# ggsave(filename = "plt5.png",
#        dpi = 1200, height =12,
#        width = 16,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```


## San Vitale
```{r}
wat_bal_san$mont = factor(wat_bal_san$Mon, levels = month.abb)

(bb <- ggplot(wat_bal_san)+
  geom_line(aes(mont,  P, group = 1, color = "Precipitation"),
            size = 1) +
  geom_line(aes(mont,  Pu, group = 1, color = "Pumping"),
            size = 1) +
  geom_line(aes(mont,  Infl, group = 1, color = "Infiltration"),
            size = 1)+
  geom_line(aes(mont,  dS, group = 1, color = "dS_in_Storage"),
            size = 1)+
  scale_color_manual(name = "mm/month",
                     values=c("Precipitation" = "307FE2",
                              "Pumping" = "1E3F63", 
                              "Infiltration" ="steelblue",
                              "dS_in_Storage" = "#FAAB18")) +
    theme_cowplot() +
  labs(x = "Months", 
       y = "Average Value", 
       title = "San Vitale Basin",
       tag = "")+
  annotate(geom = "segment",
           x = c(10.5,4,8),
           xend = c(11,3.5,9.5),
           y = c(45,70, 80),
           yend = c(20,35, 70),
           arrow = arrow(type = "closed",
                         length = unit(0.10, "inches")))+
  geom_label(aes(x = 10.5, y = 45,
                 label = "high water table"),
             hjust = 0.5,
             vjust = 0.5,
             fill = "white",
             label.size = NA,
             size = 4)+
  geom_label(aes(x = 4, y = 70,
                 label = "deficit onset"),
             hjust = 0.5,
             vjust = 0.5,
             fill = "white",
             label.size = NA,
             size = 4)+
  geom_label(aes(x = 7, y = 80,
                 label = "high rainfall"),
             hjust = 0.5,
             vjust = 0.5,
             fill = "white",
             label.size = NA,
             size = 4)+
  geom_hline(yintercept = 0,
             linetype="dashed")) +
  theme(
    axis.ticks.y = element_line(),
    axis.text.y = element_text(),
    axis.title.y = element_text(),
    axis.line.y = element_line(),
    axis.ticks.x = element_line(),
    axis.text.x = element_text(),
    axis.title.x = element_text(),
    axis.line.x = element_line(),
    legend.position = "bottom"
  )

# ggsave(filename = "bb.png",
#        dpi = 1200,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
# dev.off()

```

## Rasponi
```{r}
wat_bal_ras$mont = factor(wat_bal_ras$Mon, levels = month.abb)

(cc <- ggplot(wat_bal_ras)+
  geom_line(aes(mont,  P, group = 1, color = "Precipitation"),
            size = 1) +
  geom_line(aes(mont,  Pu, group = 1, color = "Pumping"),
            size = 1) +
  geom_line(aes(mont,  Infl, group = 1, color = "Infiltration"),
            size = 1)+
  geom_line(aes(mont,  dS, group = 1, color = "dS_in_Storage"),
            size = 1)+
  scale_color_manual(name = "mm/month",
                     values=c("Precipitation" = "307FE2",
                              "Pumping" = "1E3F63", 
                              "Infiltration" ="steelblue",
                              "dS_in_Storage" = "#FAAB18")) +
    theme_cowplot() +
  labs(x = "Months",
       y = "Average Value",
       title = "Rasponi Basin",
       tag = "") +
  annotate(
    geom = "segment",
    x = c(10.5, 4, 8),
    xend = c(11, 3.5, 9.5),
    y = c(55, 35, 80),
    yend = c(25, 25, 70),
    arrow = arrow(type = "closed",
                  length = unit(0.10, "inches"))
  ) +
  geom_label(
    aes(x = 10, y = 55,
        label = "high water table"),
    hjust = 0.5,
    vjust = 0.5,
    fill = "white",
    label.size = NA,
    size = 4
  ) +
  geom_label(
    aes(x = 4, y = 38,
        label = "deficit onset"),
    hjust = 0.5,
    vjust = 0.5,
    fill = "white",
    label.size = NA,
    size = 4
  ) +
  geom_label(
    aes(x = 7, y = 80,
        label = "high rainfall"),
    hjust = 0.5,
    vjust = 0.5,
    fill = "white",
    label.size = NA,
    size = 4
  ) +
  geom_hline(yintercept = 0,
             linetype = "dashed") +
  theme(
    axis.ticks.y = element_line(),
    axis.text.y = element_text(),
    axis.title.y = element_text(),
    axis.line.y = element_line(),
    axis.ticks.x = element_line(),
    axis.text.x = element_text(),
    axis.title.x = element_text(),
    axis.line.x = element_line(),
    legend.position = "bottom"
  )
)

ggsave(filename = "cc.png",
       dpi = 1200,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```

## Quinto
```{r}
wat_bal_quin$mont = factor(wat_bal_quin$Mon, levels = month.abb)

(aa <- ggplot(wat_bal_quin)+
  geom_line(aes(mont,  P, group = 1, color = "Precipitation"),
            size = 1) +
  geom_line(aes(mont,  Pu, group = 1, color = "Pumping"),
            size = 1) +
  geom_line(aes(mont,  Infl, group = 1, color = "Infiltration"),
            size = 1)+
  geom_line(aes(mont,  dS, group = 1, color = "dS_in_Storage"),
            size = 1)+
  scale_color_manual(
    name = "mm/month",
    values = c(
      "Precipitation" = "307FE2",
      "Pumping" = "1E3F63",
      "Infiltration" = "steelblue",
      "dS_in_Storage" = "#FAAB18"
    )
  ) +
  labs(x = "Months",
       y = "Average Value",
       title = "Quinto Basin",
       tag = "") +
  theme_cowplot()+
  annotate(
    geom = "segment",
    x = c(10.5, 4, 8),
    xend = c(11, 3.5, 9.5),
    y = c(55, 35, 80),
    yend = c(30, 25, 70),
    arrow = arrow(type = "closed",
                  length = unit(0.10, "inches"))
  ) +
  geom_label(
    aes(x = 10, y = 55,
        label = "high water table"),
    hjust = 0.5,
    vjust = 0.5,
    fill = "white",
    label.size = NA,
    size = 4
  ) +
  geom_label(
    aes(x = 4, y = 42,
        label = "high pumping"),
    hjust = 0.5,
    vjust = 0.5,
    fill = "white",
    label.size = NA,
    size = 4
  ) +
  geom_label(
    aes(x = 7, y = 80,
        label = "high rainfall"),
    hjust = 0.5,
    vjust = 0.5,
    fill = "white",
    label.size = NA,
    size = 4
  ) +
  geom_hline(yintercept = 0,
             linetype = "dashed") +
    theme_cowplot() +
  theme(
    axis.ticks.y = element_line(),
    axis.text.y = element_text(),
    axis.title.y = element_text(),
    axis.line.y = element_line(),
    axis.ticks.x = element_line(),
    axis.text.x = element_text(),
    axis.title.x = element_text(),
    axis.line.x = element_line(),
    legend.position = "bottom"
  )
)
# ggsave(filename = "aa.png",
#        dpi = 1200,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
# dev.off()
```

## Water Budget ----
## San Vitale
```{r}
df1 <- melt(water_budget[,c("Sub_period",
                   "Pump_SanVitale","Actual_ET", 
                   "Precipitation", "Seep_SanVitale")], id.vars = 1)


(pl1 <- ggplot(df1,
                aes(x = Sub_period,
                    y =value)) + 
      geom_bar(aes(fill = variable), 
           stat = "identity", 
           position = "dodge",
           width = 0.8) + 
      geom_line() +
      labs(x = "Sub-period",
           y = "??mm",
           title = "Change in San Vitale Water Budget") +
    theme_cowplot() +
      scale_fill_brewer(palette="Reds") +
      theme_cowplot() +
      annotate(geom = "text", 
           x = c(1,2,3, 4, 5),  
           y = c(200,200, -200, 200,200), 
           label = c("",
                     "",
                     "",
                     "",
                     ""),
           size = 3) +
     geom_hline(yintercept = 0)+
     geom_vline(xintercept = 1.5)) +
      theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line(),
      legend.position = "bottom"
    )


# ggplotly(aet)

# ggsave(filename = "pl1.png",
#        dpi = 1200, height = 4,
#        width = 8,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```

## Rasponi 
```{r}
df2 <- melt(water_budget[,c("Sub_period",
                   "Pump_Rasponi","Actual_ET", 
                   "Precipitation", "Seep_Rasponi")], id.vars = 1)


(pl2 <- ggplot(df2,
                aes(x = Sub_period,
                    y =value)) + 
      geom_bar(aes(fill = variable), 
           stat = "identity", 
           position = "dodge",
           width = 0.8) + 
      geom_line() +
      labs(x = "Sub-period",
           y = "??mm",
           title = "Change in Rasponi Water Budget") +
      scale_fill_brewer(palette="Reds") +
      theme_cowplot() +
      annotate(geom = "text", 
           x = c(1,2,3, 4, 5),  
           y = c(200,200, -200, 200,200), 
           label = c("",
                     "",
                     "",
                     "",
                     ""),
           size = 3) +
     geom_hline(yintercept = 0)+
     geom_vline(xintercept = 1.5)) +
      theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line(),
      legend.position = "bottom"
    )


# ggsave(filename = "pl2.png",
#        dpi = 1200, height = 4,
#        width = 8,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```

## Quinto
```{r}
df3 <- melt(water_budget[,c("Sub_period",
                   "Pump_Quinto","Actual_ET", 
                   "Precipitation", "Seep_Quinto")], id.vars = 1)


(pl3 <- ggplot(df3,
                aes(x = Sub_period,
                    y =value)) + 
      geom_bar(aes(fill = variable), 
           stat = "identity", 
           position = "dodge",
           width = 0.8) + 
      geom_line() +
      labs(x = "Sub-period",
           y = "??mm",
           title = "Change in Quinto Water Budget") +
      scale_fill_brewer(palette="Reds") +
      theme_cowplot() +
      annotate(geom = "text", 
           x = c(1,2,3, 4, 5),  
           y = c(200,200, -200, 200,200), 
           label = c("",
                     "",
                     "",
                     "",
                     ""),
           size = 3) +
     geom_hline(yintercept = 0)+
     geom_vline(xintercept = 1.5)) +
      theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line(),
      legend.position = "bottom"
    )


# ggsave(filename = "pl3.png",
#        dpi = 1200, height = 4,
#        width = 8,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```

## Drought Index ----
## SPI
```{r, warning= FALSE}
# Concert date to POSXCIT
newyear <- parse_date_time(spi.data[,1], "by")
dates <- as.Date.POSIXct(newyear)


Drought_pos1 <- ifelse(spi.data$spi <= 0, 0, spi.data$spi)
Drought_neg1 <- ifelse(spi.data$spi >= 0, 0, spi.data$spi)

df <- tibble(spi.data, Drought_neg1, Drought_pos1, dates)

(
  drought.spi <- ggplot(df) +
    geom_area(aes(dates, Drought_pos1, fill = "wetter_period")) +
    geom_area(aes(dates, Drought_neg1, fill = "drier_period")) +
    labs(x = "Time",
         y = "Normalized Value",
         title = "Standardized Precipitation Index (SPI)",
         tag = "A",
         subtitle = "Rainfall parameterization only") +
    scale_x_date(
      date_breaks = "5 year",
      date_minor_breaks = "5 year",
      date_labels = "%Y"
    ) +
    theme_cowplot() +
    scale_fill_manual("SPI",
                      values = c(
                        wetter_period = "blue",
                        drier_period = "red"
                      )) +
    theme(
      axis.ticks.y = element_line(),
      axis.text.y = element_text(),
      axis.title.y = element_text(),
      axis.line.y = element_line(),
      axis.ticks.x = element_line(),
      axis.text.x = element_text(),
      axis.title.x = element_text(),
      axis.line.x = element_line(),
      legend.position = "none"
    ) +
    annotate(
      geom = "curve",
      x = as.Date("1988-04-01"),
      y = 2,
      xend = as.Date("1985-04-01"),
      yend = -0.2,
      curvature = 0.3,
      arrow = arrow(length = unit(2, "mm"))
    ) +
   geom_label(
       x = as.Date("1980-04-01"),
      y = 2,
      label = "extended period of dryness",
      hjust = "left",
      size = 5
    ) +
  annotate("rect",
           alpha = 0,
           color = "black",
        xmin = as.Date("1983-04-01"), xmax = as.Date("1993-04-01"),
        ymin = -2.5, ymax = -0.2, 
        size = 0.5) 
)

ggsave(filename = "drouht.spi.png",
       dpi = 1200, height = 4,
       width = 10,
       path ="D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()

#+scale_color_manual(" ", values=c(wetter="blue", drier="red")) 
```
## SPEI
```{r}
newyear = parse_date_time(Drought_Index[,1], "by")
dates = as.Date.POSIXct(newyear)

#spei index
Drought1 = Drought_Index
Drought_pos <- ifelse(Drought1$spei <= 0, 0, Drought1$spei)  

Drought2 = Drought_Index
Drought_neg <- ifelse(Drought2$spei >= 0, 0, Drought2$spei) 

df <- cbind.data.frame(Drought_Index, Drought_neg, Drought_pos)

(
  drought.spei = ggplot(df) +
    geom_area(aes(dates, Drought_pos,
                  fill = "wetter_period"),
              alpha = 1) +
    geom_area(aes(dates, Drought_neg,
                  fill = "drier_period"), alpha = 1) +
    labs(x = "Time",
         y = "Normalized Value",
         title = "Standardized Precipitation Evaporation Index (SPEI)",
         tag = "B",
         subtitle = "Rainfall and temperature (Hagreave's Formula) parameterization") +
    theme_cowplot() +
    scale_fill_manual(
      " ",
      values = c(
        wetter_period = "blue",
        drier_period = "red",
        alpha = 0.5
      )
    ) +
  scale_x_date(date_breaks = "5 year",
               date_minor_breaks = "5 year",
               date_labels = "%Y") +
  theme(
    axis.ticks.y = element_line(),
    axis.text.y = element_text(),
    axis.title.y = element_text(),
    axis.line.y = element_line(),
    axis.ticks.x = element_line(),
    axis.text.x = element_text(),
    axis.title.x = element_text(),
    axis.line.x = element_line(),
    legend.position = "bottom"
    )+
      annotate(
      geom = "curve",
      x = as.Date("1988-04-01"),
      y = 2,
      xend = as.Date("1985-04-01"),
      yend = -0.2,
      curvature = 0.3,
      arrow = arrow(length = unit(2, "mm"))
    ) +
   geom_label(
       x = as.Date("1980-04-01"),
      y = 2,
      label = "extended period of dryness",
      hjust = "left",
      size = 5
    ) +
  annotate("rect",
           alpha = 0,
           color = "black",
        xmin = as.Date("1983-04-01"), xmax = as.Date("2000-04-01"),
        ymin = -2.2, ymax = -0.2, 
        size = 0.5) 
)
ggsave(filename = "drouht.spei.png",
       dpi = 1200, height = 4,
       width = 10,
       path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Project_Manuscript/Presentation")
dev.off()
```


## Subsidence ----
```{r,warning= FALSE}
## Columns of Subsidence
 Q <- subsidence[,2]
 R <- subsidence[,3]
 S <- subsidence[,4]
## Adding up in cumulative value
 Q <- cumsum(subsidence$Q) 
 R <- cumsum(subsidence$R)
 S <- cumsum(subsidence$S)
year <- subsidence$Year
## Combined into data frame
 df <- cbind.data.frame(Q, R, S, year)

 
 (sub <- ggplot(df) +
     geom_line(aes(year,
                   Q,
                   color = "Quinto_basin"),
               size = 1.5) +
     geom_line(aes(year,
                   S,
                   color = "S.Vitale_basin"),
               size = 1.5) +
     geom_line(aes(year,
                   R,
                   color = "Rasponi_basin"),
               size = 1.5) +
     labs(
       x = "Time",
       y = "Subsidence (mm/year)",
       title = "Cummulative Subsidence (1972 to 2016)",
       caption = "",
       values = c(
         "Quinto_basin" = "307FE2",
         "S.Vitale_basin" = "steelblue",
         "Rasponi_basin" = "#FAAB18"
       )
     ) +
     theme_cowplot() +
     theme(
    axis.ticks.y = element_line(),
    axis.text.y = element_text(),
    axis.title.y = element_text(),
    axis.line.y = element_line(),
    axis.ticks.x = element_line(),
    axis.text.x = element_text(),
    axis.title.x = element_text(),
    axis.line.x = element_line(),
    legend.position = "bottom",
    legend.title = element_blank(),
    ) +
     annotate(
       geom = "segment",
       x = 1985,
       xend = 1974,
       y = 200,
       yend = 200,
       arrow = arrow(type = "closed",
                     length = unit(2, "mm"))
     ) +
     geom_label(
       aes(x = 1987, y = 200,
           label = "Anthropogenic"),
       hjust = 0.5,
       vjust = 0.5,
       fill = "white",
       label.size = NA,
       size = 4
     )
   
  )

#  ggsave(filename = "sub.png",
#        dpi = 1200, height = 6,
#        width = 10,
#        path = "D:/Bologna Project/Land_Reclamation_Excel_Data/Plot")
# dev.off()
```










